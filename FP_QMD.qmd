---
title: "Covid-19 case study"
subtitle: "Tracking and anlayzing cases throughout the US States"
author: "Naman Khandelwal, Riya Merchant, and Aditi Kumar"
date: "December 14, 2025"

format:
  pdf:
    number-sections: true
    fig-align: center
    cap-location: top
    geometry:
      - top=1in
      - left=1in
      - right=1in
      - bottom=1in
    colorlinks: true

execute:
  echo: false
  warning: false

editor: visual
---

## Introduction

The New York Times state-level dataset provides a daily record of cases and deaths for each state, which allows for a data-driven exploration of how the virus spread. Since this project uses those public counts to describe broad patterns, we can focus on simple summaries that are appropriate for an introductory course. Then, the analysis begins with an overview of the dataset, which would then move to geographic comparisons and trends over time. Each team member is responsible for a distinct part of the workflow, like data cleaning or visualization. Thus, throughout the report, the team emphasizes clear documentation and ethical use of data, which allows others to re-run the analysis on the same file using our code.

## Data Provenance

In this project, we use a COVID-19 dataset from The New York Times which contains cumulative counts of cases and deaths for each state. Then, since our file covers the period from January 21, 2020 to March 23, 2023, we can get the data based on the minimum and maximum dates. Then, because the values are aggregated from health agencies, they are made available as a CSV file on GitHub, which would allow us to use it.

## FAIR and CARE Principles

For this project, the NYTimes data is consistent with FAIR principles because it is widely accessible online. Since it uses stable identifiers like state names and follows a table structure, this would allow it to be combined with other data like population estimates for analysis. Then, the data is also findable and reusable because it comes from a good publisher with clear updates, which allows it to support questions about patterns in the pandemic. At the same time, it is important to look at CARE principles by realizing that COVID results show differences across communities. Then, since we want to avoid blaming specific states, we should focus on context like healthcare access and health differences. Thus, when looking at results, the team will frame the analysis to respect communities, which avoids claiming too much and shows how clear data can help public health responses.

```{r}
# ---- Global Setup & Data Loading ----
library(tidyverse)
library(lubridate)
library(janitor)
library(knitr)
library(kableExtra)

# Read Data Once
# Using the GitHub raw link provided in your provenance section
us_states <- read_csv(
  "https://raw.githubusercontent.com/nytimes/covid-19-data/master/us-states.csv",
  show_col_types = FALSE
) %>%
  clean_names()

# Master Data Cleaning
# 1. Fix Date
# 2. Calculate New Cases (Daily Incidence) immediately so all sections can use it
covid_clean <- us_states %>%
  # Handle potential format differences safely
  mutate(date = parse_date_time(date, orders = c("ymd", "mdy"))) %>% 
  mutate(date = as.Date(date)) %>%
  arrange(state, date) %>%
  group_by(state) %>%
  mutate(
    new_cases = cases - lag(cases, default = 0),
    new_deaths = deaths - lag(deaths, default = 0)
  ) %>%
  ungroup() %>%
  # Clean up any negative spikes from data corrections
  mutate(new_cases = ifelse(new_cases < 0, 0, new_cases))
#| label: naman-overview

# Create one-row-per-state summary
state_summary <- covid_clean %>%
  group_by(state) %>%
  summarise(
    total_cases = max(cases, na.rm = TRUE),
    total_deaths = max(deaths, na.rm = TRUE),
    first_date = min(date, na.rm = TRUE),
    last_date = max(date, na.rm = TRUE)
  ) %>%
  arrange(desc(total_cases))

# Show top 10 states by total cases
state_summary %>%
  slice_head(n = 10) %>%
  kable(
    caption = "Table 1: Overview of NYTimes state-level COVID-19 data (Top 10 States).",
    col.names = c("State", "Total Cases", "Total Deaths", "First Report", "Last Report")
  ) %>%
  kable_styling(latex_options = "scale_down")

# ---- Visualization: Cumulative Trends ----
states_of_interest <- c("Pennsylvania", "New York", "California")

plot_data_naman <- covid_clean %>%
  filter(state %in% states_of_interest)

ggplot(plot_data_naman, aes(x = date, y = cases, color = state)) +
  geom_line(linewidth = 1) +
  labs(
    title = "Cumulative COVID-19 Cases Over Time",
    subtitle = "Comparing Pennsylvania, New York, and California",
    x = "Date",
    y = "Cumulative Cases",
    caption = "Data source: NYTimes"
  ) +
  theme_minimal() +
  theme(legend.position = "bottom")
```

## Geographic EDA (Riya)

This section explores geographic differences in COVID-19 spread across U.S. states.\
We highlight which states had the highest overall case counts and visualize how the pandemic evolved across the most affected states.

```{r}
#| label: riya-geo-eda

# ---- Riya Table: Peak Days ----
# This table finds the single worst day for the top 10 states.
# It helps us answer: "When was the pandemic at its absolute worst?"
top_states_list <- state_summary %>% 
  slice_head(n = 10) %>% 
  pull(state)

peak_days <- covid_clean %>%
  filter(state %in% top_states_list) %>%
  group_by(state) %>%
  filter(new_cases == max(new_cases, na.rm = TRUE)) %>%
  select(state, date, peak_cases = new_cases) %>%
  arrange(desc(peak_cases))

kable(peak_days,
      caption = "Table 2: The Single Worst Day of Infections for the Top 10 States.",
      col.names = c("State", "Date of Peak", "Max Daily Cases")) %>%
  kable_styling(full_width = FALSE)


# ---- Riya Graph: Total Impact Comparison (Bar Chart) ----
# Instead of a messy line graph, we use a Horizontal Bar Chart.
# This clearly compares the magnitude of the pandemic across states.

# 1. Filter to top 15 states so the chart fits on the page
bar_data <- covid_clean %>%
  group_by(state) %>%
  summarize(total_cases = max(cases, na.rm = TRUE)) %>%
  arrange(desc(total_cases)) %>%
  slice_head(n = 15)

# 2. Plot
ggplot(bar_data, aes(x = reorder(state, total_cases), y = total_cases)) +
  geom_col(fill = "steelblue") +   # geom_col creates the bars
  coord_flip() +                   # FLIP chart so state names are easy to read
  labs(
    title = "Total COVID-19 Cases: Top 15 States",
    subtitle = "Comparing the total scale of the pandemic across major states",
    x = "State",
    y = "Total Cases (Cumulative)"
  ) +
  scale_y_continuous(labels = scales::comma) + # Adds commas to the big numbers (e.g. 10,000,000)
  theme_minimal()
```

```         
```

```{r}
#| label: time-analysis
#| fig-alt: "Bar chart showing total new COVID-19 cases per week in the United States, with the largest bars occurring during winter surge periods."
#| fig-cap: "Figure 3. National weekly COVID-19 case volume."

# Code Style Guide: Tidyverse Style Guide
# Primary Author: Aditi
# Reviewer: Naman

# ---- Weekly Aggregation ----
weekly <- covid_clean %>%
  group_by(week = floor_date(date, "week")) %>%
  summarize(
    weekly_new_cases = sum(new_cases, na.rm = TRUE),
    weekly_new_deaths = sum(new_deaths, na.rm = TRUE),
    .groups = "drop"
  )

# ---- Weekly Summary Table ----
kable(
  head(weekly, 10),
  caption = "Table 2. First 10 Weeks of National COVID-19 Volume",
  col.names = c("Week", "New Cases", "New Deaths")
) %>%
  kable_styling(full_width = FALSE)

# ---- Visualization: Weekly Volume (Bar Chart) ----
# A bar chart is used here to emphasize the magnitude of weekly case surges.
ggplot(weekly, aes(x = week, y = weekly_new_cases)) +
  geom_col(fill = "#4E79A7") +
  labs(
    title = "National Weekly COVID-19 Volume",
    x = "Week",
    y = "Total New Cases per Week",
    caption = "Bar chart highlights the magnitude of winter COVID-19 surges."
  ) +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal()

This weekly bar chart emphasizes the magnitude of COVID-19 transmission over time.
Tall bars indicate weeks with exceptionally high numbers of new cases, particularly during winter surges.
Using a bar chart instead of a line plot makes it easier to compare the relative size of weekly outbreaks and highlights how dramatically case volume increased during peak periods.

```{}
#| fig-alt: "Line plot showing monthly total COVID-19 cases in the United States, illustrating smoothed pandemic waves over time."
#| fig-cap: "Figure 4. Monthly COVID-19 case trends in the United States."

# Primary Author: Aditi
# Reviewer: Naman

# ---- Monthly Aggregation ----
monthly <- covid_clean %>%
  group_by(month = floor_date(date, "month")) %>%
  summarize(
    monthly_new_cases = sum(new_cases, na.rm = TRUE),
    .groups = "drop"
  )

# ---- Visualization: Monthly Trends ----
ggplot(monthly, aes(x = month, y = monthly_new_cases)) +
  geom_line(color = "darkred", linewidth = 1) +
  geom_point(color = "darkred") +
  labs(
    title = "Monthly COVID-19 Cases",
    subtitle = "Smoothed view of pandemic waves",
    x = "Month",
    y = "Total Cases per Month"
  ) +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal()

The monthly trend plot smooths out short-term fluctuations and reveals broader pandemic patterns.
This visualization makes it easier to identify major waves and compare their relative severity over time.
Notably, the largest monthly peak corresponds to the Omicron surge, reinforcing the importance of temporal aggregation when interpreting public health data.



Narrative: How COVID-19 Changed Over Time

COVID-19 did not spread evenly over time. By examining weekly and monthly totals, several clear patterns emerge:

Distinct waves: Both the weekly and monthly plots show multiple sharp increases corresponding to major national waves.

Early slow growth: Initial case counts rise gradually, reflecting limited spread and limited testing early in the pandemic.

Large mid-pandemic surges: Several large spikes represent periods when infections accelerated nationwide.

Deaths lag behind cases: While both grow over time, deaths tend to rise shortly after cases, consistent with clinical expectations.

Seasonal patterns: Some of the largest increases align with colder months, when indoor transmission increases.

This temporal EDA highlights how the pandemic progressed through time and supports deeper analysis of patterns and risks.
