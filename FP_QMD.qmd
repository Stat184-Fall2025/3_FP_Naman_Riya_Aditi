---
title: "Covid-19 case study"
subtitle: "Tracking and analyzing cases throughout the US States"
author: "Naman Khandelwal, Riya Merchant, and Aditi Kumar"
date: "December 14, 2025"

format:
  pdf:
    number-sections: true
    fig-align: center
    cap-location: top
    geometry:
      - top=1in
      - left=1in
      - right=1in
      - bottom=1in
    colorlinks: true

execute:
  echo: false
  warning: false

editor: visual
---

## Introduction

The New York Times state-level dataset provides a daily record of cases and deaths for each state, which allows for a data-driven exploration of how the virus spread. Since this project uses public counts to describe broad patterns, the analysis focuses on summaries appropriate for an introductory statistics course. The report begins with an overview of the dataset, followed by geographic comparisons across states and an examination of trends over time. Throughout the report, the team emphasizes clear documentation, ethical use of data, and reproducibility.

## Data Provenance

This project uses the New York Times COVID-19 state-level dataset, which contains cumulative daily counts of confirmed cases and deaths for each U.S. state. The dataset spans from January 21, 2020 to March 23, 2023 and is compiled from state and local health agencies. The data are publicly available as a CSV file on GitHub, allowing transparent and reproducible analysis.

## FAIR and CARE Principles

The NYTimes COVID-19 dataset aligns with FAIR principles because it is openly accessible, well-documented, and structured in a standardized tabular format. Stable identifiers such as state names and dates allow the dataset to be reused and combined with other data sources. CARE principles are also considered, as COVID-19 data reflect real impacts on communities. This analysis avoids assigning blame to specific states and instead focuses on broader public health patterns.

```{r}
<<<<<<< HEAD
#| label: global-setup

# Code Style Guide: Tidyverse Style Guide

# Primary Author: Naman

# Reviewer: Riya
=======
# ---- Global Setup & Data Loading ----
library(tidyverse)
library(lubridate)
library(janitor)
library(knitr)
library(kableExtra)

# Read Data Once
# Using the GitHub raw link provided in your provenance section
us_states <- read_csv(
  "https://raw.githubusercontent.com/nytimes/covid-19-data/master/us-states.csv",
  show_col_types = FALSE
) %>%
  clean_names()

# Master Data Cleaning
# 1. Fix Date
# 2. Calculate New Cases (Daily Incidence) immediately so all sections can use it
covid_clean <- us_states %>%
  # Handle potential format differences safely
  mutate(date = parse_date_time(date, orders = c("ymd", "mdy"))) %>% 
  mutate(date = as.Date(date)) %>%
  arrange(state, date) %>%
  group_by(state) %>%
  mutate(
    new_cases = cases - lag(cases, default = 0),
    new_deaths = deaths - lag(deaths, default = 0)
  ) %>%
  ungroup() %>%
  # Clean up any negative spikes from data corrections
  mutate(new_cases = ifelse(new_cases < 0, 0, new_cases))
#| label: naman-overview

# Create one-row-per-state summary
state_summary <- covid_clean %>%
  group_by(state) %>%
  summarise(
    total_cases = max(cases, na.rm = TRUE),
    total_deaths = max(deaths, na.rm = TRUE),
    first_date = min(date, na.rm = TRUE),
    last_date = max(date, na.rm = TRUE)
  ) %>%
  arrange(desc(total_cases))

# Show top 10 states by total cases
state_summary %>%
  slice_head(n = 10) %>%
  kable(
    caption = "Table 1: Overview of NYTimes state-level COVID-19 data (Top 10 States).",
    col.names = c("State", "Total Cases", "Total Deaths", "First Report", "Last Report")
  ) %>%
  kable_styling(latex_options = "scale_down")

# ---- Visualization: Cumulative Trends ----
states_of_interest <- c("Pennsylvania", "New York", "California")

plot_data_naman <- covid_clean %>%
  filter(state %in% states_of_interest)

ggplot(plot_data_naman, aes(x = date, y = cases, color = state)) +
  geom_line(linewidth = 1) +
  labs(
    title = "Cumulative COVID-19 Cases Over Time",
    subtitle = "Comparing Pennsylvania, New York, and California",
    x = "Date",
    y = "Cumulative Cases",
    caption = "Data source: NYTimes"
  ) +
  theme_minimal() +
  theme(legend.position = "bottom")
```

## Geographic EDA (Riya)

This section explores geographic differences in COVID-19 spread across U.S. states.\
We highlight which states had the highest overall case counts and visualize how the pandemic evolved across the most affected states.

```{r}
#| label: riya-geo-eda

# ---- Riya Table: Peak Days ----
# This table finds the single worst day for the top 10 states.
# It helps us answer: "When was the pandemic at its absolute worst?"
top_states_list <- state_summary %>% 
  slice_head(n = 10) %>% 
  pull(state)

peak_days <- covid_clean %>%
  filter(state %in% top_states_list) %>%
  group_by(state) %>%
  filter(new_cases == max(new_cases, na.rm = TRUE)) %>%
  select(state, date, peak_cases = new_cases) %>%
  arrange(desc(peak_cases))

kable(peak_days,
      caption = "Table 2: The Single Worst Day of Infections for the Top 10 States.",
      col.names = c("State", "Date of Peak", "Max Daily Cases")) %>%
  kable_styling(full_width = FALSE)


# ---- Riya Graph: Total Impact Comparison (Bar Chart) ----
# Instead of a messy line graph, we use a Horizontal Bar Chart.
# This clearly compares the magnitude of the pandemic across states.

# 1. Filter to top 15 states so the chart fits on the page
bar_data <- covid_clean %>%
  group_by(state) %>%
  summarize(total_cases = max(cases, na.rm = TRUE)) %>%
  arrange(desc(total_cases)) %>%
  slice_head(n = 15)

# 2. Plot
ggplot(bar_data, aes(x = reorder(state, total_cases), y = total_cases)) +
  geom_col(fill = "steelblue") +   # geom_col creates the bars
  coord_flip() +                   # FLIP chart so state names are easy to read
  labs(
    title = "Total COVID-19 Cases: Top 15 States",
    subtitle = "Comparing the total scale of the pandemic across major states",
    x = "State",
    y = "Total Cases (Cumulative)"
  ) +
  scale_y_continuous(labels = scales::comma) + # Adds commas to the big numbers (e.g. 10,000,000)
  theme_minimal()
```

```         
```

```{r}
#| label: time-analysis

# ---- Weekly Aggregation ----
weekly <- covid_clean %>%
  group_by(week = floor_date(date, "week")) %>%
  summarize(
    weekly_new_cases = sum(new_cases, na.rm = TRUE),
    weekly_new_deaths = sum(new_deaths, na.rm = TRUE)
  )

# Weekly Table
kable(head(weekly, 10),
      caption = "Table 2. First 10 Weeks of National COVID-19 Volume",
      col.names = c("Week", "New Cases", "New Deaths")) %>%
  kable_styling(full_width = FALSE)

# ---- Visualization: Weekly Volume (Bar Chart) ----
# Using a Bar Chart here to differentiate from previous line charts
ggplot(weekly, aes(x = week, y = weekly_new_cases)) +
  geom_col(fill = "#4E79A7") +
  labs(
    title = "National Weekly COVID-19 Volume",
    x = "Week",
    y = "Total New Cases per Week",
    caption = "Bar chart highlights the magnitude of the winter surges."
  ) +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal()

# ---- Monthly Aggregation ----
monthly <- covid_clean %>%
  group_by(month = floor_date(date, "month")) %>%
  summarize(
    monthly_new_cases = sum(new_cases, na.rm = TRUE)
  )

# ---- Visualization: Monthly Trends ----
ggplot(monthly, aes(x = month, y = monthly_new_cases)) +
  geom_line(color = "darkred", linewidth = 1) +
  geom_point(color = "darkred") +
  labs(
    title = "Monthly COVID-19 Cases",
    subtitle = "Smoothed view of pandemic waves",
    x = "Month",
    y = "Total Cases per Month"
  ) +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal()
```

Narrative: How COVID-19 Changed Over Time

COVID-19 did not spread evenly over time. By examining weekly and monthly totals, several clear patterns emerge:

Distinct waves: Both the weekly and monthly plots show multiple sharp increases corresponding to major national waves.

Early slow growth: Initial case counts rise gradually, reflecting limited spread and limited testing early in the pandemic.

Large mid-pandemic surges: Several large spikes represent periods when infections accelerated nationwide.

Deaths lag behind cases: While both grow over time, deaths tend to rise shortly after cases, consistent with clinical expectations.

Seasonal patterns: Some of the largest increases align with colder months, when indoor transmission increases.

This temporal EDA highlights how the pandemic progressed through time and supports deeper analysis of patterns and risks.

# Code Appendix

```{r}
#| label: code-appendix
#| echo: TRUE
#| eval: FALSE

# ==============================================================================
# SECTION 1: GLOBAL SETUP & DATA PROVENANCE
# ==============================================================================
>>>>>>> parent of 2b00c95 (Merge branch 'main' of https://github.com/Stat184-Fall2025/3_FP_Naman_Riya_Aditi)

library(tidyverse)
library(lubridate)
library(janitor)
library(knitr)
library(kableExtra)

us_states <- read_csv(
  "https://raw.githubusercontent.com/nytimes/covid-19-data/master/us-states.csv",
  show_col_types = FALSE
) %>%
  clean_names()

covid_clean <- us_states %>%
mutate(date = as.Date(date)) %>%
arrange(state, date) %>%
group_by(state) %>%
mutate(
new_cases = cases - lag(cases, default = 0),
new_deaths = deaths - lag(deaths, default = 0)
) %>%
ungroup() %>%
mutate(new_cases = ifelse(new_cases < 0, 0, new_cases))

state_summary <- covid_clean %>%
group_by(state) %>%
summarise(
total_cases = max(cases, na.rm = TRUE),
total_deaths = max(deaths, na.rm = TRUE),
first_date = min(date, na.rm = TRUE),
last_date = max(date, na.rm = TRUE),
.groups = "drop"
) %>%
arrange(desc(total_cases))

state_summary %>%
slice_head(n = 10) %>%
kable(
caption = "Table 1: Overview of NYTimes state-level COVID-19 data (Top 10 States).",
col.names = c("State", "Total Cases", "Total Deaths", "First Report", "Last Report")
) %>%
kable_styling(latex_options = "scale_down")

#| label: cumulative-trends
#| fig-alt: "Line chart of cumulative COVID-19 cases from 2020 to 2023 for Pennsylvania, New York, and California, showing multiple surges with a steep rise during the 2021–2022 winter period."
#| fig-cap: "Figure 1. Cumulative COVID-19 cases over time for Pennsylvania, New York, and California."

# Primary Author: Naman

# Reviewer: Riya

states_of_interest <- c("Pennsylvania", "New York", "California")

plot_data <- covid_clean %>%
filter(state %in% states_of_interest)

ggplot(plot_data, aes(x = date, y = cases, color = state)) +
geom_line(linewidth = 1) +
labs(
title = "Cumulative COVID-19 Cases Over Time",
x = "Date",
y = "Cumulative Cases",
caption = "Data source: New York Times"
) +
theme_minimal() +
theme(legend.position = "bottom")

### Narrative: Cumulative COVID-19 Trends Across States

Figure 1 shows the cumulative number of COVID-19 cases over time for Pennsylvania, New York, and California. These states were selected because they are large, highly populated, and experienced some of the highest total case counts during the pandemic. The figure highlights how case counts increased steadily early on, followed by sharper rises during major national surges.

A particularly steep increase is visible during the winter of 2021–2022, corresponding to the Omicron variant surge, which affected multiple states simultaneously. While all three states follow a similar overall pattern, differences in the slope of the curves reflect variation in population size, timing of outbreaks, and local public health responses. This visualization helps establish a baseline understanding of how the pandemic evolved across major U.S. states before examining more detailed geographic and temporal patterns later in the report.

```
