---
title: "QMD_FP"
author: "Naman"
format: pdf
editor: visual
---

## Introduction

The New York Times state-level dataset provides a daily record of cases and deaths for each state, which allows for a data-driven exploration of how the virus spread. Since this project uses those public counts to describe broad patterns, we can focus on simple summaries that are appropriate for an introductory course. Then, the analysis begins with an overview of the dataset, which would then move to geographic comparisons and trends over time. Each team member is responsible for a distinct part of the workflow, like data cleaning or visualization. Thus, throughout the report, the team emphasizes clear documentation and ethical use of data, which allows others to re-run the analysis on the same file using our code.

## Data Provenance

In this project, we use a COVID-19 dataset from The New York Times which contains cumulative counts of cases and deaths for each state. Then, since our file covers the period from January 21, 2020 to March 23, 2023, we can get the data based on the minimum and maximum dates. Then, because the values are aggregated from health agencies, they are made available as a CSV file on GitHub, which would allow us to use it.

## FAIR and CARE Principles

For this project, the NYTimes data is consistent with FAIR principles because it is widely accessible online. Since it uses stable identifiers like state names and follows a table structure, this would allow it to be combined with other data like population estimates for analysis. Then, the data is also findable and reusable because it comes from a good publisher with clear updates, which allows it to support questions about patterns in the pandemic. At the same time, it is important to look at CARE principles by realizing that COVID results show differences across communities. Then, since we want to avoid blaming specific states, we should focus on context like healthcare access and health differences. Thus, when looking at results, the team will frame the analysis to respect communities, which avoids claiming too much and shows how clear data can help public health responses.

```{r}
# code header: primary = Naman, reviewer = Riya
# Style guide: Tidyverse
library(knitr)
library(tidyverse)
library(lubridate)

# Data Section
# Read in NYTimes US states data 
us_states <- read_csv(
  "https://raw.githubusercontent.com/Stat184-Fall2025/3_FP_Naman_Riya_Aditi/refs/heads/main/us-states.csv",
  show_col_types = FALSE
)

# Basic cleaning / type fixes
covid_states <- us_states |>
  mutate(
    date  = as.Date(date, format = "%m/%d/%Y"),
    state = as.factor(state)
  )
# Table Section
# find the last date in the cleaned dataset
last_date <- max(covid_states$date, na.rm = TRUE)
# create one-row-per-state summary
dataset_overview <- covid_states |>
  group_by(state) |>
  summarise(
    total_cases_latest = max(cases, na.rm = TRUE),
    total_deaths_latest = max(deaths, na.rm = TRUE),
    first_reporting_date = min(date, na.rm = TRUE),
    last_reporting_date = max(date, na.rm = TRUE),
    .groups = "drop"
  ) |>
  arrange(desc(total_cases_latest))

# show top 10 states by total cases
dataset_overview |>
  slice_head(n = 10) |>
  kable(
    caption = "Table 1: Overview of NYTimes state-level COVID-19 data, showing the latest cumulative cases and deaths and the first/last reporting dates for the ten states with the largest total case counts."
  )

# Visualization Section
library(ggplot2)
# Define the specific states we want to compare
states_of_interest <- c("Pennsylvania", "New York", "California")
# Filter the main dataset to include only these selected states
plot_data <- covid_states |>
  filter(state %in% states_of_interest)
# Create the line plot
ggplot(plot_data, aes(x = date, y = cases, color = state)) +
  geom_line(linewidth = 1) +
  labs(
    title = "Cumulative COVID-19 cases over time for selected U.S. states",
    x = "Date",
    y = "Cumulative cases",
    color = "State",
    caption = "Data source: NYTimes state-level COVID-19 data (us-states.csv)."
  ) +
  # Apply a clean, minimal theme
  theme_minimal(base_size = 12) +
  theme(
    plot.title = element_text(face = "bold"),
    legend.position = "bottom"
  )
```
## Geographic EDA (Riya)

This section explores geographic differences in COVID-19 spread across U.S. states.\
We highlight which states had the highest overall case counts and visualize how the pandemic evolved across the most affected states.

```{r}
# ---- Riya Feature Engineering ----
# Add new_cases column (simple feature)

covid_states <- covid_states |>
  group_by(state) |>
  arrange(date) |>
  mutate(new_cases = cases - lag(cases)) |>
  ungroup()

# Top 10 states by total cases
top_states <- dataset_overview |>
  slice_head(n = 10)

# Table for Top 10 states
top_states |>
  kable(
    caption = "Table 2: Top 10 U.S. states with the highest total COVID-19 cases."
  )
```
```{r}
# ---- Riya Geographic Plot ----

top_plot_data <- covid_states |>
  filter(state %in% top_states$state)

ggplot(top_plot_data, aes(x = date, y = cases, color = state)) +
  geom_line() +
  labs(
    title   = "COVID-19 Trends for Top 10 U.S. States by Total Cases",
    x       = "Date",
    y       = "Cumulative Cases",
    caption = "Data source: NYTimes us-states.csv"
  ) +
  theme_minimal()
```
```{r}
# Load libraries
library(tidyverse)
library(lubridate)
library(janitor)
library(knitr)
library(kableExtra)
 
# Import dataset
covid <- read_csv("us-states.csv") %>%
  clean_names()

# Convert date column
covid <- covid %>%
  mutate(date = as.Date(date))

Weekly Trends

Weekly summaries help reduce noise and reveal broader patterns.
weekly <- covid %>%
group_by(state, week = floor_date(date, "week")) %>%
summarize(
total_cases = max(cases, na.rm = TRUE),
total_deaths = max(deaths, na.rm = TRUE),
.groups = "drop"
) %>%
arrange(state, week)

Weekly Summary Table
weekly_table <- weekly %>%
group_by(week) %>%
summarize(
weekly_cases = sum(total_cases),
weekly_deaths = sum(total_deaths)
)

kable(weekly_table[1:10, ],
caption = "Table 1. First 10 Weeks of Total U.S. COVID-19 Cases and Deaths",
col.names = c("Week", "Total Cases", "Total Deaths")) %>%
kable_styling(full_width = FALSE)

Weekly Cases Over Time
ggplot(weekly_table, aes(x = week, y = weekly_cases)) +
geom_line() +
labs(
title = "Weekly COVID-19 Cases in the United States",
x = "Week",
y = "Total Cases",
caption = "Figure 1. Weekly total cases show major COVID-19 waves across the U.S."
)

Monthly Trends

Monthly data helps identify long-term patterns and major peaks.
monthly <- covid %>%
group_by(state, month = floor_date(date, "month")) %>%
summarize(
total_cases = max(cases),
total_deaths = max(deaths),
.groups = "drop"
) %>%
arrange(state, month)

monthly_totals <- monthly %>%
group_by(month) %>%
summarize(
monthly_cases = sum(total_cases),
monthly_deaths = sum(total_deaths)
)

Monthly Summary Table
kable(monthly_totals[1:10, ],
caption = "Table 2. First 10 Months of U.S. COVID-19 Cases and Deaths",
col.names = c("Month", "Cases", "Deaths")) %>%
kable_styling(full_width = FALSE)

Monthly Case Trends
ggplot(monthly_totals, aes(x = month, y = monthly_cases)) +
geom_line() +
labs(
title = "Monthly COVID-19 Cases in the United States",
x = "Month",
y = "Total Cases",
caption = "Figure 2. Monthly cases provide a smoothed view of pandemic waves."
)
```
Narrative: How COVID-19 Changed Over Time

COVID-19 did not spread evenly over time.
By examining weekly and monthly totals, several clear patterns emerge:

Distinct waves: Both the weekly and monthly plots show multiple sharp increases corresponding to major national waves.

Early slow growth: Initial case counts rise gradually, reflecting limited spread and limited testing early in the pandemic.

Large mid-pandemic surges: Several large spikes represent periods when infections accelerated nationwide.

Deaths lag behind cases: While both grow over time, deaths tend to rise shortly after cases, consistent with clinical expectations.

Seasonal patterns: Some of the largest increases align with colder months, when indoor transmission increases.

This temporal EDA highlights how the pandemic progressed through time and supports deeper analysis of patterns and risks.
